!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("@zup-it/beagle-web/dist/utils/tree-reading"),require("@zup-it/beagle-web"),require("@angular/core"),require("reflect-metadata")):"function"==typeof define&&define.amd?define("beagle-angular",["exports","@zup-it/beagle-web/dist/utils/tree-reading","@zup-it/beagle-web","@angular/core","reflect-metadata"],t):t((e=e||self)["beagle-angular"]={},e.treeReading,e.createCoreBeagleUIService,e.ng.core)}(this,(function(e,t,n,r){"use strict";n=n&&n.hasOwnProperty("default")?n.default:n;
/*! *****************************************************************************
    Copyright (c) Microsoft Corporation. All rights reserved.
    Licensed under the Apache License, Version 2.0 (the "License"); you may not use
    this file except in compliance with the License. You may obtain a copy of the
    License at http://www.apache.org/licenses/LICENSE-2.0

    THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
    KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
    WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
    MERCHANTABLITY OR NON-INFRINGEMENT.

    See the Apache Version 2.0 License for specific language governing permissions
    and limitations under the License.
    ***************************************************************************** */
var o=function(e,t){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)};function i(e,t){function n(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}var a=function(){return(a=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)};function u(e,t,n,r){var o,i=arguments.length,a=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var u=e.length-1;u>=0;u--)(o=e[u])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a}function c(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)}function l(e,t){var n,r,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:u(0),throw:u(1),return:u(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function u(i){return function(u){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,r=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=(o=a.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=t.call(e,a)}catch(e){i=[6,e],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,u])}}}var f={};function s(e,n){if(!e||!n)throw Error("Beagle: getContext couldn't find viewId or elementId");var r=f[e];if(!r)throw Error("Beagle: getContext couldn't find view with id "+e);return function(e,n){return{replace:function(t){return e.updateWithFetch(t,n,"replace")},append:function(t){return e.updateWithFetch(t,n,"append")},prepend:function(t){return e.updateWithFetch(t,n,"prepend")},updateWithTree:function(t){return e.updateWithTree(a(a({},t),{elementId:n}))},getElementId:function(){return n},getElement:function(){return t.findById(e.getTree(),n)},getView:function(){return e}}}(r,n)}var p=function(e){function t(t){return e.call(this,"Beagle runtime error: "+t)||this}return i(t,e),t}(function(e){function t(t){var n=e.call(this,t)||this;return n.name=n.constructor.name,n}return i(t,e),t}(Error)),d=1,h=function(){function e(e,t,n){var r,o=this;this.loadParams={path:""},this.viewId=""+d++,this.viewStaticPromise=((r={}).promise=new Promise((function(e,t){r.resolve=e,r.reject=t})),r),this.updateView=function(e){o.ngZone.run((function(){o.tree=e,o.changeDetector.detectChanges()}))},e&&(this.beagleProvider=e),t&&(this.ngZone=t),n&&(this.changeDetector=n)}return e.prototype.createBeagleView=function(){var e,t,n=this.beagleProvider.getBeagleUIService();if(!n)throw new p("you need to start the beagle provider before using a remote view.");this.view=n.createView(),this.view.subscribe(this.updateView),this.view.addErrorListener((function(e){e.forEach((function(e){console.error(e)}))})),e=""+this.viewId,t=this.view,f[e]=t,this.viewStaticPromise.resolve(this.view)},e.prototype.getTemplate=function(e){return this[e]||console.warn("Beagle: the component "+e+" was not declared in Beagle's configuration."),this[e]},e.prototype.elementIdentity=function(e,t){return t.id},e.prototype.getView=function(){return this.viewStaticPromise.promise},e.prototype.ngAfterViewInit=function(){if(!this.beagleProvider||!this.ngZone||!this.changeDetector)throw new p('"beagleProvider", "ngZone" and "changeDetector" must be set before the AfterViewInit runs. Use the constructor or the component instance to set their values.');this.createBeagleView(),this.view.updateWithFetch(this.loadParams)},e.prototype.ngOnChanges=function(e){return t=this,n=void 0,o=function(){return l(this,(function(t){return e&&e.loadParams&&e.loadParams.previousValue&&e.loadParams.previousValue!==e.loadParams.currentValue&&this.view.updateWithFetch(this.loadParams),[2]}))},new((r=void 0)||(r=Promise))((function(e,i){function a(e){try{c(o.next(e))}catch(e){i(e)}}function u(e){try{c(o.throw(e))}catch(e){i(e)}}function c(t){t.done?e(t.value):new r((function(e){e(t.value)})).then(a,u)}c((o=o.apply(t,n||[])).next())}));var t,n,r,o},e.prototype.ngOnDestroy=function(){var e;e=this.viewId,delete f[e]},e}(),g=function(){function e(){}return e.prototype.start=function(e){this.service?console.error("Beagle service has already started!"):this.service=n(e)},e.prototype.getBeagleUIService=function(){return this.service},e}(),v=function(){},w=function(){function e(e,t){this.viewContainerRef=e,this.elementRef=t}return e.prototype.ngOnInit=function(){var e,t,n,r=this;(n=ng&&"function"==typeof ng.getComponent?ng.getComponent(this.elementRef.nativeElement):null===(t=null===(e=this.viewContainerRef._data)||void 0===e?void 0:e.componentView)||void 0===t?void 0:t.component)instanceof v&&(n.getBeagleContext=function(){return s(r._viewId,r._elementId)})},e.ctorParameters=function(){return[{type:r.ViewContainerRef},{type:r.ElementRef}]},u([r.Input(),c("design:type",String)],e.prototype,"_elementId",void 0),u([r.Input(),c("design:type",String)],e.prototype,"_viewId",void 0),e=u([r.Directive({selector:"[beagle-context]"}),c("design:paramtypes",[r.ViewContainerRef,r.ElementRef])],e)}(),y=function(){function e(){}return e=u([r.NgModule({declarations:[w],exports:[w]})],e)}();e.AbstractBeagleProvider=g,e.AbstractBeagleRemoteView=h,e.BeagleComponent=v,e.BeagleContextModule=y,e.BeagleModule=function(e){return function(t){Reflect.defineMetadata("beagleConfig",e,t)}},e.getBeagleConfigMetadata=function(e){return Reflect.getMetadata("beagleConfig",e)},e.ɵa=w,e.ɵb="beagle-context",Object.defineProperty(e,"__esModule",{value:!0})}));
//# sourceMappingURL=beagle-angular.umd.min.js.map