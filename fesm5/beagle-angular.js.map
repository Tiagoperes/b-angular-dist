{"version":3,"file":"beagle-angular.js","sources":["ng://beagle-angular/runtime/beagle-context/context.ts","ng://beagle-angular/runtime/utils/promise.ts","ng://beagle-angular/errors.ts","ng://beagle-angular/runtime/errors.ts","ng://beagle-angular/runtime/AbstractBeagleRemoteView.ts","ng://beagle-angular/runtime/AbstractBeagleProvider.ts","ng://beagle-angular/constants.ts","ng://beagle-angular/runtime/BeagleComponent.ts","ng://beagle-angular/runtime/beagle-context/directive.ts","ng://beagle-angular/runtime/beagle-context/module.ts","ng://beagle-angular/decorator.ts","ng://beagle-angular/beagle-angular.ts"],"sourcesContent":["import { BeagleView } from 'beagle-web'\nimport { findById } from 'beagle-web/dist/utils/tree-reading'\nimport { BeagleContext } from '../../types'\n\nconst views: Record<string, BeagleView> = {}\n\nfunction createContext<T>(view: BeagleView<T>, elementId: string): BeagleContext<T> {\n  return {\n    replace: params => view.updateWithFetch(params, elementId, 'replace'),\n    append: params => view.updateWithFetch(params, elementId, 'append'),\n    prepend: params => view.updateWithFetch(params, elementId, 'prepend'),\n    updateWithTree: params => view.updateWithTree({ ...params, elementId }),\n    getElementId: () => elementId,\n    getElement: () => findById(view.getTree(), elementId),\n    getView: () => view\n  }\n}\n\nexport function getContext(viewId: string, elementId: string) {\n  if (!viewId || !elementId) throw Error('Beagle: getContext couldn\\'t find viewId or elementId')\n\n  const view = views[viewId]\n  if (!view) throw Error(`Beagle: getContext couldn\\'t find view with id ${viewId}`)\n\n  return createContext(view, elementId)\n}\n\nexport function registerView(viewId, view: BeagleView) {\n  views[viewId] = view\n}\n\nexport function unregisterView(viewId) {\n  delete views[viewId]\n}\n","export interface StaticPromise<T> {\n  resolve: (value: any) => void,\n  reject: (error: any) => void,\n  promise: Promise<T>,\n}\n\nexport function createStaticPromise<T = any>() {\n  const staticPromise: Partial<StaticPromise<T>> = {}\n\n  staticPromise.promise = new Promise((resolve, reject) => {\n    staticPromise.resolve = resolve\n    staticPromise.reject = reject\n  })\n\n  return staticPromise as StaticPromise<T>\n}","export default class BeagleError extends Error {\n  constructor(message?: string) {\n    super(message)\n    this.name = this.constructor.name\n  }\n}\n","import BeagleError from '../errors'\n\nexport default class BeagleRuntimeError extends BeagleError {\n  constructor(message: string) {\n    super(`Beagle runtime error: ${message}`)\n  }\n}\n","import {\n  AfterViewInit,\n  OnDestroy,\n  OnChanges,\n  SimpleChanges,\n  ChangeDetectorRef,\n  NgZone,\n  TemplateRef,\n} from '@angular/core'\nimport { AbstractBeagleProvider } from './AbstractBeagleProvider'\nimport { LoadParams, BeagleView, IdentifiableBeagleUIElement } from 'beagle-web'\nimport { registerView, unregisterView } from './beagle-context/context'\nimport { createStaticPromise } from './utils/promise'\nimport BeagleRuntimeError from './errors'\n\nlet nextViewId = 1\n\nexport abstract class AbstractBeagleRemoteView implements AfterViewInit, OnDestroy, OnChanges {\n  loadParams: LoadParams = { path: '' }\n  tree: IdentifiableBeagleUIElement<any>\n  view: BeagleView\n  viewId = `${nextViewId++}`\n  beagleProvider: AbstractBeagleProvider\n  ngZone: NgZone\n  changeDetector: ChangeDetectorRef\n  viewStaticPromise = createStaticPromise<BeagleView>()\n\n  constructor(\n    beagleProvider?: AbstractBeagleProvider,\n    ngZone?: NgZone,\n    changeDetector?: ChangeDetectorRef,\n  ) {\n    if (beagleProvider) this.beagleProvider = beagleProvider\n    if (ngZone) this.ngZone = ngZone\n    if (changeDetector) this.changeDetector = changeDetector\n  }\n\n  createBeagleView() {\n    const beagleService = this.beagleProvider.getBeagleUIService()\n    if (!beagleService) {\n      throw new BeagleRuntimeError('you need to start the beagle provider before using a remote view.')\n    }\n    this.view = beagleService.createView()\n    this.view.subscribe(this.updateView)\n    this.view.addErrorListener((errorListener) => {\n      errorListener.forEach((error) => {\n        console.error(error)\n      })\n    })\n    registerView(`${this.viewId}`, this.view)\n    this.viewStaticPromise.resolve(this.view)\n  }\n\n  getTemplate(componentName: IdentifiableBeagleUIElement<any>['type']): TemplateRef<any> {\n    if (!this[componentName]) {\n      console.warn(`Beagle: the component ${componentName} was not declared in Beagle's configuration.`)\n    }\n    return this[componentName]\n  }\n\n  updateView = (uiTree: IdentifiableBeagleUIElement<any>) => {\n    this.ngZone.run(() => {\n      this.tree = uiTree\n      this.changeDetector.detectChanges()\n    })\n  }\n\n  elementIdentity(index: number, element: IdentifiableBeagleUIElement<any>) {\n    return element.id\n  }\n\n  getView() {\n    return this.viewStaticPromise.promise\n  }\n\n  ngAfterViewInit() {\n    if (!this.beagleProvider || !this.ngZone || !this.changeDetector) {\n      throw new BeagleRuntimeError(`\"beagleProvider\", \"ngZone\" and \"changeDetector\" must be set before the AfterViewInit runs. Use the constructor or the component instance to set their values.`)\n    }\n    this.createBeagleView()\n    this.view.updateWithFetch(this.loadParams)\n  }\n\n  async ngOnChanges(changes: SimpleChanges) {\n    if (changes && changes.loadParams) {\n      if (\n        changes.loadParams.previousValue\n        && changes.loadParams.previousValue !== changes.loadParams.currentValue\n      ) {\n        this.view.updateWithFetch(this.loadParams)\n      }\n    }\n  }\n\n  ngOnDestroy() {\n    unregisterView(this.viewId)\n  }\n}\n","import { BeagleAngularConfig, BeagleAngularUIService } from '../types'\nimport createCoreBeagleUIService, { DefaultSchema } from 'beagle-web'\n\nexport abstract class AbstractBeagleProvider {\n  private service: BeagleAngularUIService | undefined\n\n  start<Schema = DefaultSchema>(baseUrl: string) {\n    if (this.service) {\n      console.error('Beagle service has already started!')\n      return\n    }\n    // @ts-ignore // fixme\n    this.service = createCoreBeagleUIService<Schema>({ baseUrl })\n  }\n\n  getBeagleUIService() {\n    return this.service\n  }\n}\n","export const viewIdAttributeName = '__beagle_view_id'\nexport const remoteViewSelector = 'beagle-remote-view'\nexport const contextSelector = 'beagle-context'\n","import { BeagleContext } from '../types'\n\nexport abstract class BeagleComponent {\n  public getBeagleContext: () => BeagleContext\n}\n","import { Directive, ViewContainerRef, ElementRef, OnInit, Input } from '@angular/core'\nimport { contextSelector } from '../../constants'\nimport { BeagleComponent } from '../BeagleComponent'\nimport { getContext } from './context'\n\n@Directive({\n  selector: `[${contextSelector}]`,\n})\nexport class BeagleContextDirective implements OnInit {\n  @Input() _elementId: string\n  @Input() _viewId: string\n\n  constructor(public viewContainerRef: ViewContainerRef, public elementRef: ElementRef) { }\n\n  ngOnInit() {\n    let component\n\n    // @ts-ignore\n    if (ng && typeof (ng.getComponent) === 'function') {\n      //IVY provides ng.getComponent function whereas other versions don't\n      // @ts-ignore\n      component = ng.getComponent(this.elementRef.nativeElement)\n    } else {\n      \n      // @ts-ignore\n      component = this.viewContainerRef._data?.componentView?.component\n    }\n    if (component instanceof BeagleComponent) {\n      component.getBeagleContext = () => getContext(this._viewId, this._elementId)\n    }\n  }\n}\n","import { NgModule } from '@angular/core'\nimport { BeagleContextDirective } from './directive'\n\n@NgModule({\n  declarations: [BeagleContextDirective],\n  exports: [BeagleContextDirective],\n})\nexport class BeagleContextModule {}\n","import { Type } from '@angular/core'\nimport { DefaultSchema } from 'beagle-web'\nimport 'reflect-metadata'\nimport { BeagleAngularConfig } from './types'\n\nexport function BeagleModule<Schema = DefaultSchema>(config: BeagleAngularConfig<Schema>) {\n  return function (target: Type<any>) {\n    Reflect.defineMetadata('beagleConfig', config, target)\n  }\n}\n","/**\n * Generated bundle index. Do not edit.\n */\n\nexport * from './index';\n\nexport {contextSelector as ɵb} from './constants';\nexport {BeagleContextDirective as ɵa} from './runtime/beagle-context/directive';"],"names":[],"mappings":"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"}